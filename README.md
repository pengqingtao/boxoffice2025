# BoxOffice 票房数据抓取工具

这是一个用于从 BoxOfficeMojo 网站抓取电影票房排行数据的Python工具。

## 功能特点

- 抓取指定年月的电影票房排行数据（前10名）
- 获取电影排名、英文片名、累计票房、首映日期等信息
- **🆕 双平台评分系统**：自动获取IMDb评分和豆瓣评分
- **🆕 中英文片名对照**：根据英文片名自动查找对应中文片名
- 自动保存数据到CSV文件
- 支持中文界面和提示
- 中文日期格式显示（如：5月23日）

## 安装依赖

首先安装所需的Python包：

```bash
pip install -r requirements.txt
```

## 使用方法

### 方式一：单月数据抓取

**1. 运行主程序**

```bash
python boxoffice_scraper.py
```

**2. 按提示输入信息**

程序会要求你输入：
- 年份（例如：2025）
- 月份（1-12）

**3. 查看结果**

程序会：
1. 显示抓取进度
2. 展示数据预览
3. 自动保存到CSV文件（保存在 `data/` 目录下）

### 方式二：批量抓取多月数据

**1. 运行批量抓取程序**

```bash
python batch_scraper.py
```

**2. 按提示输入信息**

程序会要求你输入：
- 年份（例如：2024）
- 开始月份（1-12）
- 结束月份（1-12）

**3. 查看结果**

程序会：
1. 按顺序抓取指定月份范围的数据
2. 显示每月抓取进度和统计
3. 将所有数据合并保存到一个CSV文件

## 输出数据格式

CSV文件包含以下七列：
- `排名`: 电影在当月的票房排名
- `英文片名`: 电影的英文名称
- `中文片名`: 电影的中文译名（如：星际宝贝史迪奇）
- `累计票房`: 累计票房收入（美元）
- `首映日期`: 电影首映日期（中文格式，如：5月23日）
- `IMDb评分`: IMDb评分（1-10分，如：7.0）
- `豆瓣评分`: 豆瓣评分（1-10分，如：7.2）

## 示例

```
=== BoxOfficeMojo 票房数据抓取工具 ===

请输入年份 (例如: 2025): 2024
请输入月份 (1-12): 5

开始抓取 2024年5月 的票房数据...
--------------------------------------------------
正在抓取: https://www.boxofficemojo.com/month/may/2024/?ref_=bo_ml_table_1
已抓取: 1. Kingdom of the Planet of the Apes
已抓取: 2. The Fall Guy
...
成功抓取 10 条电影数据
--------------------------------------------------
抓取完成！共获得 10 条电影数据

数据预览:
1. Kingdom of the Planet of the Apes / 猩球崛起：王国黎明 - $171,130,165 (5月10日) [IMDb: 6.8, 豆瓣: 7.2]
2. The Fall Guy / 特技替身 - $92,900,355 (5月3日) [IMDb: 6.8, 豆瓣: 6.9]
3. IF / 如果 - $111,375,918 (5月17日) [IMDb: 8.1, 豆瓣: 6.7]
...

所有数据已保存到: data/boxoffice_2024_05.csv
```

## 文件结构

```
BoxOffice/
├── boxoffice_scraper.py    # 主程序文件（单月抓取）
├── batch_scraper.py        # 批量抓取程序（多月抓取）
├── requirements.txt        # 依赖包列表
├── README.md              # 说明文档
└── data/                  # 数据保存目录
    ├── boxoffice_YYYY_MM.csv    # 单月抓取的数据文件（如：boxoffice_2025_05.csv）
    └── batch_boxoffice_YYYY_MM_to_MM.csv  # 批量抓取的数据文件
```

## 文件管理

- **单月抓取**：文件名格式为 `boxoffice_YYYY_MM.csv`（如：`boxoffice_2025_05.csv`）
- **相同年月覆盖**：如果再次抓取相同年月的数据，会覆盖旧文件，不会创建重复文件
- **批量抓取**：文件名格式为 `batch_boxoffice_YYYY_MM_to_MM.csv`

## 注意事项

1. 请遵守网站的使用条款和 robots.txt 规则
2. 程序包含适当的延时，避免对服务器造成过大压力
3. 如果抓取失败，请检查网络连接或稍后重试
4. 数据仅供学习和研究使用
5. 相同年月的数据会覆盖旧文件，如需保留历史数据请手动备份
6. **双平台评分获取**：由于需要搜索IMDb和豆瓣网站，抓取时间会相应增加（每部电影约5-8秒）
7. 如果评分搜索失败，相应数据会显示为"N/A"
8. 豆瓣评分基于内置电影库匹配，可根据需要扩展电影映射表

## 技术实现

- 使用 `requests` 进行HTTP请求
- 使用 `BeautifulSoup` 解析HTML内容
- 使用 `pandas` 处理和保存数据
- **双平台评分集成**：
  - **IMDb集成**：智能搜索IMDb网站并提取电影评分
  - **豆瓣集成**：基于内置电影库进行中英文片名匹配和评分获取
- **智能匹配算法**：支持精确匹配和模糊匹配
- 支持错误处理和用户友好的提示信息
- 智能延时机制，避免请求过于频繁

## ✨ 双平台评分系统详情

### 🎯 年份智能匹配
程序现在支持**年份智能匹配**功能，能够根据票房统计年份自动选择最相近的电影版本：

**同名电影多版本处理示例：**
- 搜索"The Lion King"时：
  - 如果是2024年数据 → 匹配2019年CG版《狮子王》(评分7.4)
  - 如果是1995年数据 → 匹配1994年经典版《狮子王》(评分9.1)
- 搜索"Spider-Man"时：
  - 2002年 → 《蜘蛛侠》(托比·马奎尔版)
  - 2012年 → 《超凡蜘蛛侠》(安德鲁·加菲尔德版)  
  - 2017年 → 《蜘蛛侠：英雄归来》(汤姆·霍兰德版)

### 🌟 豆瓣电影功能
#### 电影映射机制
程序内置了丰富的电影数据库，包括：
- **多版本电影**：迪士尼经典重拍(如：《美女与野兽》1991/2017版)
- **系列电影**：超级英雄电影(《蝙蝠侠》1989/2005/2008/2016版)
- **经典续作**：《星球大战》、《侏罗纪公园》等系列
- **2024-2025年新片**：最新上映电影

#### 智能匹配算法
1. **年份优先匹配**：根据票房统计年份选择最接近的版本
2. **精确匹配**：完全匹配英文片名
3. **模糊匹配**：部分关键词匹配（如"Mad Max" → "疯狂的麦克斯"）
4. **智能回退**：未找到年份匹配时回退到基本匹配
5. **容错处理**：未匹配电影显示"N/A"

#### 扩展方法
如需添加新的电影映射，可编辑 `get_douban_movie_mapping()` 方法：

```python
# 多版本电影格式
'Movie Title': [
    ('中文片名1', '评分1', 年份1),
    ('中文片名2', '评分2', 年份2),
],
# 单版本电影格式  
'Single Movie': [('中文片名', '评分', 年份)],
```

### 🔍 IMDb评分功能
- **年份匹配搜索**：尝试根据年份选择最相近的电影版本
- **多选择器支持**：使用多种CSS选择器确保评分准确性
- **智能回退机制**：年份匹配失败时使用常规搜索
- **网络容错**：处理连接超时和页面结构变化

### 📊 匹配效果展示
实际测试结果：
```
🎬 测试: Furiosa: A Mad Max Saga (目标年份: 2024)
    找到部分匹配版本: 疯狂的麦克斯 (1979) 差距: 45年
    找到部分匹配版本: 疯狂的麦克斯：狂暴之路 (2015) 差距: 9年  
    找到部分匹配版本: 芙莉欧萨：疯狂的麦克斯传奇 (2024) 差距: 0年
    ✅ 选择最佳匹配: 芙莉欧萨：疯狂的麦克斯传奇 (2024) 评分: 8.6
``` 